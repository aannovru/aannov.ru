<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru-ru" lang="ru-ru"> 
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Анонимные Алкоголики Нижний Новгород</title>
   <meta name="author" content="Анонимные Алкоголики Нижний Новгород" />
   <link href="http://feeds.feedburner.com/aannovru" rel="alternate" 
         title="Анонимные Алкоголики Нижний Новгород" type="application/atom+xml" />
   <link rel="shortcut icon" href="/favicon.ico" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
</head>
<body>

<div class="site">
  <h1 class="header"><a href="/">Анонимные Алкоголики Нижний Новгород</a></h1>
  <div id="aa_motto_parent_div">      
    <div id="aa_motto_img_div">  
      <a href="/"><img id="aa_motto_img" src="/images/aa-logo-en.gif"
          alt="Выздоровление Единство Служение" />
      </a>    
    </div>    

    <div id="aa_motto_child_div" >
      <p>
        <a id="aa_motto_link_no_underline" class="aa_motto_link_no_underline" href="/solution">    
          Выздоровление Единство Служение
        </a>
        ♦ 
        <a id="aa_motto_link_no_underline" class="aa_motto_link_no_underline" href="/solution">    
          12 Шагов
        </a>
        <br />
        +79601979248 <br />
        <a href="mailto:aannovru@gmail.com">aannovru@gmail.com</a>        
      </p>
    </div>
  </div>

  <div class="title" id="aa_menu_div">
    <a class="extra" href="/">Главная</a>
    <a class="extra" href="/solution">12 Шагов</a>
    <a class="extra" href="/community">Как нас найти</a>
    <a class="extra" href="/stories">Наши истории</a>
    <a class="extra" href="/links">Ссылки</a>
  </div>

  
    
   



<div id="post">
  
    <p>
  
    <a href="/solution">→&nbsp;12 Шагов</a>
  
</p>
<!-- vim: set sts=2 sw=2 et: --> 


    
      <p>
      <span class="post_tags">Метки:&nbsp;</span>
        
          <a class="post_tags_underline" href="/solution/index.html#метка1">
            <u>метка1</u>
          </a>
          &nbsp;&nbsp;
        
          <a class="post_tags_underline" href="/solution/index.html#метка2">
            <u>метка2</u>
          </a>
          &nbsp;&nbsp;
        
      </p>
    
  

    
  <h1>Load Rails conditionally with Rack</h1>
  <p class="meta">
    10.11.2009
    <a href="/solution/2009/11/10/load-rails-conditionally-with-rack.html">(ссылка)</a>   
  </p>

  <p>One of the great things about <a href="http://gemcutter.org">Gemcutter</a> is that it&#8217;s using <a href="http://www.sinatrarb.com">Sinatra</a> via <a href="http://guides.rubyonrails.org/rails_on_rack.html">Rails Metal</a> to serve up the gems. Recently, I had to run some long migrations (~10 minutes) and I&#8217;m sure we&#8217;ll have some more in the future. Since the gem server is decoupled from the Rails app, some clever Rack loading now allows us to continue to serve gems even when we&#8217;re down for maintenance.</p>
<p>The <code>config.ru</code> now looks like this:</p>
<p>Liquid error: No such file or directory &#8211; pygmentize -l ruby -f html -O encoding=utf-8</p>
<p>So now, Heroku treats Gemcutter as a Rack app, and not a pure Rails app. Normally, it&#8217;ll just use Thin and boot up Rails as normal with <code>Rack::Adapter::Rails</code>. <code>script/server</code> still works as normal, too, but I&#8217;ll probably use <a href="http://github.com/rtomayko/shotgun">shotgun</a> instead.</p>
<p>The fun begins when you run <code>MAINTENANCE_MODE=on rackup</code>. The following happens from there:</p>
<ul>
	<li>Load up the <a href="http://litanyagainstfear.com/blog/2009/10/14/gem-bundler-is-the-future/">Bundler</a> environment that has all of our gems, and some of Rails&#8217; magic.</li>
	<li>Fire up <a href="http://rack.rubyforge.org/doc/classes/Rack/Static.html">Rack::Static</a> to serve static assets like the images and <span class="caps">CSS</span> to make the site look nice</li>
	<li>Use the <a href="http://github.com/qrush/gemcutter/blob/master/app/metal/hostess.rb">Hostess</a>, Gemcutter&#8217;s Sinatra gem server to continue to serve gems</li>
	<li>All other requests are then caught by David Dollar&#8217;s <a href="http://github.com/ddollar/rack-maintenance">rack-maintenance</a> that simply serves up a static <span class="caps">HTML</span> page.</li>
	<li>Use <code>Sinatra::Application</code> since we need some sort of endpoint.</li>
</ul>
<p>And boom, we have a read-only site that continues to serve gems. Rack rules.</p>
<p style="text-align:center;"><img src="http://6.media.tumblr.com/tumblr_kobz0jtHsN1qzln4lo1_400.jpg" alt="" /></p>
</div>

<!-- vim: set sts=2 sw=2 et: --> 

  
  <div class="footer">
    <div class="contact">
      <p>
        Анонимные Алкоголики Нижний Новгород<br />
        +79601979248<br />
        <a href="mailto:aannovru@gmail.com">aannovru@gmail.com</a>        
      </p>
    </div>

    <div class="rss">
      <a href="http://feeds.feedburner.com/aannovru">
        <img src="/images/rss.png" alt="Subscribe to RSS Feed" />
      </a>
    </div>
  </div>
</div>

</body>
</html>
<!-- vim: set sts=2 sw=2 et: --> 
